// ==============================
//       CUSTOM LOGGER LOOTY
// ==============================

// ğŸ”§ Chargement de la configuration
const config = require('./config');

// ğŸ•’ Fonction qui retourne la date/heure actuelle formatÃ©e en FR (Europe/Paris)
const now = () => new Date().toLocaleString("fr-FR", {
  timeZone: "Europe/Paris"
});

// ğŸŒ Environnement courant dÃ©fini dans la config (ex: development, production)
const currentEnv = config.APP_ENVIRONMENTS;

// ğŸšï¸ DÃ©finition des niveaux de logs autorisÃ©s par environnement
// Chaque environnement a ses propres niveaux affichables
const LOG_LEVELS = {
  debug:       ["debug", "info", "success", "maj", "timer", "warn", "error"],
  development: ["info", "success", "maj", "timer", "warn", "error"],
  production:  ["success", "warn", "error"]
};

/**
 * âœ… VÃ©rifie si un niveau de log donnÃ© est autorisÃ© dans l'environnement actuel
 * @param {string} level - Niveau du log (debug, info, success, etc.)
 * @returns {boolean} - true si on doit logger, sinon false
 */
function shouldLog(level) {
  return LOG_LEVELS[currentEnv]?.includes(level);
}

/**
 * ğŸ’¬ Fonction gÃ©nÃ©rique pour afficher les logs dans la console
 * â¤ ColorÃ©e, emoji, timestampÃ©e et conditionnÃ©e par l'environnement
 *
 * @param {"log" | "warn" | "error"} type - MÃ©thode de console Ã  utiliser
 * @param {string} emoji - IcÃ´ne du type de log (visuel rapide)
 * @param {string} color - Code couleur depuis config
 * @param {string} levelName - Niveau logique du log (pour filtrage env)
 * @param {string} message - Message principal
 * @param {string} [message2] - Message secondaire ou complÃ©ment
 */
function log(type, emoji, color, levelName, message, message2 = "") {
  if (!shouldLog(levelName)) return;

  const timestamp = `${config.WHITE}${now()} : ${emoji} ${color}${message}${config.WHITE}${message2}`;
  console[type](timestamp);
}

// ==============================
//       EXPORT DES MÃ‰THODES
// ==============================

module.exports = {
  /**
   * ğŸ Debug : visible seulement en env "debug"
   */
  debug(message, message2 = "") {
    log("log", "ğŸ", config.BLUE, "debug", message, message2);
  },

  /**
   * â„¹ï¸  Info : pour informations gÃ©nÃ©rales
   */
  info(message, message2 = "") {
    log("log", "â„¹ï¸ ", config.BLUE, "info", message, message2);
  },

  /**
   * âœ… Success : pour actions rÃ©ussies (sauvegarde, init, etc.)
   */
  success(message, message2 = "") {
    log("log", "âœ…", config.GREEN, "success", message, message2);
  },

  /**
   * ğŸ”„ MAJ : pour signaler une mise Ã  jour ou un changement
   */
  maj(message, message2 = "") {
    log("log", "ğŸ”„", config.GREEN, "maj", message, message2);
  },

  /**
   * âŒ› Timer : utile pour afficher des mesures de temps ou de latence
   */
  timer(message, message2 = "") {
    log("log", "âŒ›", config.BLUE, "timer", message, message2);
  },

  /**
   * âš ï¸  Avertissement : pour situations non bloquantes mais Ã  surveiller
   */
  warn(message, message2 = "") {
    log("warn", "âš ï¸", config.RED, "warn", message, message2);
  },

  /**
   * âŒ Erreur : pour erreurs critiques, affiche aussi l'objet d'erreur
   */
  error(message, err) {
    if (!shouldLog("error")) return;

    const timestamp = `${config.WHITE}${now()} : âŒ ${config.RED}${message}${config.WHITE}`;
    console.error(timestamp, err); // err peut Ãªtre un objet, string ou stack
  }
};
