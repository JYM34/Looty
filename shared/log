const config = require('./config');

// ğŸ•’ Horodatage en FR (Europe/Paris)
const now = () => new Date().toLocaleString("fr-FR", { timeZone: "Europe/Paris" });

// ğŸ” Niveau dâ€™environnement courant
const currentEnv = config.APP_ENVIRONMENTS;

// ğŸšï¸ Niveaux de logs autorisÃ©s par environnement
const LOG_LEVELS = {
  debug:      ["debug", "info", "success", "maj", "timer", "warn", "error"],
  development: ["info", "success", "maj", "timer", "warn", "error"],
  production:  ["success", "warn", "error"]
};

/**
 * âœ… VÃ©rifie si un type de log est autorisÃ© dans lâ€™environnement courant
 * @param {string} level - Type de log Ã  afficher
 * @returns {boolean}
 */
function shouldLog(level) {
  return LOG_LEVELS[currentEnv]?.includes(level);
}

/**
 * ğŸ’¬ Fonction de log colorÃ©e et timestampÃ©e
 * @param {"log" | "warn" | "error"} type - Type de console
 * @param {string} emoji
 * @param {string} color
 * @param {string} levelName - Niveau logique (debug, info, etc.)
 * @param {string} message
 * @param {string} [message2]
 */
function log(type, emoji, color, levelName, message, message2 = "") {
  if (!shouldLog(levelName)) return;
  const timestamp = `${config.WHITE}${now()} : ${emoji} ${color}${message}${config.WHITE}${message2}`;
  console[type](timestamp);
}

module.exports = {
  debug(message, message2 = "") {
    log("log", "ğŸ", config.BLUE, "debug", message, message2);
  },

  info(message, message2 = "") {
    log("log", "â„¹ï¸ ", config.BLUE, "info", message, message2);
  },

  success(message, message2 = "") {
    log("log", "âœ…", config.GREEN, "success", message, message2);
  },

  maj(message, message2 = "") {
    log("log", "ğŸ”„", config.GREEN, "maj", message, message2);
  },

  timer(message, message2 = "") {
    log("log", "âŒ›", config.BLUE, "timer", message, message2);
  },

  warn(message, message2 = "") {
    log("warn", "âš ï¸", config.RED, "warn", message, message2);
  },

  error(message, err) {
    if (!shouldLog("error")) return;
    const timestamp = `${config.WHITE}${now()} : âŒ ${config.RED}${message}${config.WHITE}`;
    console.error(timestamp, err);
  }
};
